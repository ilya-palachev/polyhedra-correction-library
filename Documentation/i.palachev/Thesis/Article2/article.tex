% Copyright (c) 2009-2015 Ilya Palachev <iliyapalachev@gmail.com>

\documentclass[a4paper, 10pt]{article}
%\usepackage[pass,paperwidth=17cm,paperheight=24cm]{geometry}

\usepackage[utf8]{inputenc}
\usepackage[english,russian]{babel}
\usepackage{graphicx}
%\usepackage{wrapfig}
\usepackage{amsmath,amssymb}

\usepackage{geometry}
\geometry{left=4cm}
\geometry{right=4cm}
\geometry{top=4cm}
\geometry{bottom=4cm}

% Package that enables usage of theorems and definition designed in a 
% standard way.
% http://en.wikibooks.org/wiki/LaTeX/Theorems
\usepackage{amsthm}

% Create environment for smart definitions
\theoremstyle{definition}
\newtheorem{SmartDefinition}{Определение}

% Create environment for smart theorems
\theoremstyle{plain}
\newtheorem{SmartTheorem}{Теорема}

% Create environment for smart lemmas
\theoremstyle{plain}
\newtheorem{SmartLemma}{Лемма}

\usepackage{caption,wasysym}
\usepackage{hyperref}

\title{Метод согласования измерений опорной функции выпуклого тела в метрике
$L_{\infty}$}
\author{Палачев\,И.\,А.}
\date{7 июля 2016 г.}

\begin{document}
\maketitle

\begin{abstract}
Предложен новый алгоритм решения задачи согласования измерений опорной функции
выпуклого тела в метрике $L_{\infty}$, позволяющий получить решение за
квадратичное время по числу измерений без использования линейного
программирования.
Также доказана оценка скорости сходимости, которая имеет место при довольно
слабых условиях на входные данные, что позволяет применить метод к более
широкому классу задач, чем это было прежде.
Доказанное свойство скорости сходимости позволяет утверждать, что разработанный
и представленный в статье алгоритм обладает большей  и гарантированной
стабильностью и предсказуемостью, нежели прочие алгоритмы, существовавшие и
применявшиеся для согласования измерений опорной функции до сих пор.
Приведены детали реализации алгоритма и результаты его тестирования.
\end{abstract}

\textbf{Ключевые слова:} опорная функция, восстановление геометрических тел,
теневой контур, преобразование двойственности

\textbf{1. Введение.}
Данное исследование возникло из практической задачи восстановления трёхмерного
выпуклого тела по измерениям его опорной функции. Данная задача рассматривалась
в связи с разнообразными приложениями: в компьютерной томографии
\cite{PrinceWillsky}, для обработки данных лазерного радара
\cite{LeleKulkarniWillsky}, в магнитно-резонансной визуализации
\cite{GregorRannou2001, GregorRannou2002}, при построении трехмерных моделей
драгоценных камней в ювелирной промышленности \cite{palachev} -- все эти
прикладные задачи так или иначе сводятся к решению так называемой
\textbf{задаче согласования измерений опорной функции выпуклого тела}
(разъяснение этих понятий см. ниже).

Во всех работах, посвященных решению задачи согласования, проблема сводилась к
решению задачи квадратичного (для метрики $L_2$) или линейного (для метрик
$L_1$ и $L_\infty$) программирования следующего вида:

\begin{equation*}
 ||h - h^0||_X \to \min \;\;\;\;\; s.t. \;\;\;\;\; C h \ge 0,
\end{equation*}
где $h^0$ -- исходные значения измерений опорной функции, $h$ -- неизвестные
(переменные задачи), которые требуется найти, а $C$ -- линейная матрица.

Основным камнем преткновения для решения данной задачи для измерений опорных
функций тел в $\mathbb{R}^3$ являлся тот факт, что матрица $C$ содержит в себе
квадратичное ($O(N^2)$, где $N$ -- размерность вектора $h$) число строк.

Поэтому основным направлением исследования данной задачи в ряде работ было
упрощение условий согласованности, что позволило бы записать задачу в более
компактном виде и, следовательно, решить ее за гораздо меньшее время. Так, в
работе \cite{GardnerKiderlen} была найдена возможность записи задачи
программирования в более удобных терминах точек касания (до того времени само
нахождение условий было нетривиальной задачей).

Похожую цель преследовала и статья \cite{palachev}, основной результат которой
позволил на большом классе входных данных избавиться примерно от 80\% условий
(последняя оценка, впрочем, была выведена экспериментально). Тем не
менее, это позволило лишь сдвинуть границу применимости метода, но так и не
перевело его на уровень, который позволял бы применить его к любым входным
данным.

Следующей сложностью на пути решения задачи является довольно типичная для
вычислительных методов ситуация, когда не существует алгоритма, который бы
гарантированно работал для любых входных данных. Так, в мире существуют
как коммерческие (лишь некоторые из которых доступны по академической лицензии),
так и свободные программные пакеты для решения задач квадратичного или
линейного программирования. Поскольку довольно понятным является желание
пользователя иметь гарантированное поведение программного пакета, коммерческие
пакеты, часто не раскрывающие особенности своей реализации (или оглашающие их
лишь частично), не всегда могут быть для этого удовлетворительными.

Свободные программные пакеты, такие как, например, Ipopt \cite{Ipopt},
показавший себя довольно эффективным для решения данной задачи (см. подробности
в \cite{palachev}), -- имеют открытый исходный код и основаны на результатах
научных статей \cite{WachterBiegler, WachterBiegler2}, доказывающих
свойства реализованных в них алгоритмов. Тем не менее, метод внутренней точки,
являющийся основой реализации этого пакета, при всех его достоинствах
имеет такой недостаток,
что может впасть в режим восстановления, при котором существующие оценки
скорости сходимости довольно скудны \cite {WachterBiegler2}.
Иначе говоря, алгоритм, при наличии ряда неблагоприятных обстоятельств,
может работать сколь угодно долго (если не ограничить число итераций), или
может вообще не сойтись.

В связи с этим возникает вопрос: \textbf{можно ли переформулировать задачу
согласования опорных чисел таким образом, чтобы алгоритм решения имел
гарантированную приемлемую скорость сходимости при любых входных данных?}

Данная работа призвана представить такой алгоритм для задачи в метрике
$L_\infty$. Полученный метод позволяет свести задачу к алгоритму двойчного
поиска на отрезке действительных чисел, на каждом шаге которого применяются
алгоритмы, имеющие гарантированную вычислительную сложность (построение
выпуклой оболочки, задача обнаружений пересечения отрезка и многогранника,
линейные преобразования).
Более того, как будет показано далее, данный алгоритм имеет
гарантированную (квадратичную) скорость сходимости при любых входных данных,
какую метод внутренней точки позволял иметь лишь при выполнении большого ряда
ограничений на входные данные.

Также представлены результаты реализации и тестирования алгоритма,
подтверждающие теоретически доказанные оценки и демонстирующие приемлемую
производительность на ряде примеров, полученных из эмпирических данных
для восстановления тела по его теневым контурам.

\textbf{2. Основные понятия.}
\begin{SmartDefinition}
 \label{def:support-function}
 \textbf{Опорной функцией} выпуклого тела $K \subset \mathbb{R}^{n}$
 называется
 $h_{K}: \mathbb{R}^{n} \to \mathbb{R}_{+}$:

 \begin{equation*}h_{K}(u) = \sup \limits_{x \in K}(x, u),\end{equation*}
\end{SmartDefinition}
где $u$ -- произвольный вектор в $\mathbb{R}^n$,
$(x, u)$ -- евклидово скалярное произведение этого вектора на некоторую точку
$x \in K$.

В перечисленных выше работах рассматривается следующая задача. Пусть
имеется некоторое реальное физическое тело $K$ и производятся эмпирические
измерения его опорной функции $h_{1}, h_{2}, \ldots, h_{m}$ (опорные числа) на
конечном наборе единичных векторов $u_{1}, u_{2}, \ldots, u_{m}$
(опорные направления):

\begin{equation*}
 h_{i} = h_{K}(u_{i}) + \varepsilon_{i}, \;\; i = 1, 2, \ldots, m,
\end{equation*}

где $\varepsilon_{i}$ --- погрешности измерения опорных чисел $h_{i}$.

\begin{SmartDefinition}
 \label{def:consistency}
 Опорные числа $h_{1}, h_{2}, \ldots, h_{m}$ по направлениям \\
 $u_{1}, u_{2}, \ldots, u_{m}$ называются \textbf{согласованными}, если
 существует такое выпуклое тело  $K^{*} \subset \mathbb{R}^{n}$, что
 $h_{K^{*}}(u_{i}) = h_{i}$.
\end{SmartDefinition}

Поскольку не всякий набор действительных чисел является
согласованным набором опорных чисел некоторого выпуклого тела, естественным
образом возникает задача \textit{согласования опорных чисел}: по набору опорных
чисел $h^{0}_{1}, h^{0}_{2}, \ldots, h^{0}_{m}$ и опорным направлениям
$u_{1}, u_{2}, \ldots, u_{m}$ строится такой согласованный набор опорных чисел
$h^{*}_{1}, h^{*}_{2}, \ldots, h^{*}_{m}$, который реализует минимум функционала

\begin{equation*}
 I = || h - h^{0} ||_{X},
\end{equation*}

где $X$ -- одна из метрик  в $\mathbb{R}^{m}$ (например,
$L_{2}, L_{1}, L_{\infty}$), 

В работе \cite{GardnerKiderlen} задача согласования опорных чисел сводится к
следующей задаче математического программирования:

\begin{equation}
\label{equation:gardner-kiderlen}
 ||\{(x_{i}, u_{i})\}_{i = 1}^{m} - h^{0}||_{X} \to \inf \;\;\; s. t. \;\;
 (x_{i}, u_{i}) \geq (x_{j}, u_{i}), 1 \leq i \neq j \leq m,
\end{equation}

где $x_{i} \in \mathbb{R}^{3}$ --- точки касания тела с опорной плоскостью,
имеющей нормаль $u_{i}$.


\textbf{3. Быстрый алгоритм согласования.}
Основным результатом работы \cite{palachev} является следующая теорема:

\begin{SmartTheorem}\label{theorem:exhaustive-conditions}
Рассмотрим следующую систему ограничений относительно переменных точек
$x_i \in \mathbb{R}^{3}, i = 1, \ldots, n$ и переменного вещественного числа
$\varepsilon > 0$:

\begin{equation}
\label{equation:all-constraints}
 (x_{i}, u_{i}) \geq (x_{i}, u_{j}), \;\;\;
 |(x_{i}, u_{i}) - h_{i}| \leq \varepsilon,
\end{equation}

где $u_i, i = 1, \ldots, n$ -- набор фикисрованных опорных направлений,
нормированных в евклидовой метрике (т.е. $||u_i||_{2} = 1, i = 1, \ldots, n$),
$h_i, i = 1 , \ldots, n$ -- набор соответствующих им фиксированных опорных
чисел.

Пусть система ограничений (\ref{equation:all-constraints}) разрешима
для некоторого $\varepsilon^{0}$. Введем многогранник $K$ по следующей формуле:

\begin{equation}
\label{equation:upper-bounds-polyhedron}
 K = \bigcap \limits_{i = 1}^{m}\{(x, u_{i}) \leq h_{i} + \varepsilon^{0}\}.
\end{equation}

Пусть $\delta$ - полярное преобразование двойственности.
Тогда если отрезок, соединяющий точки
$\delta(\{(x, u_{i}) = h_{i} - \varepsilon^{0}\})$ и
$\delta(\{(x, u_{j}) = h_{j} - \varepsilon^{0}\})$, пересекает
$\delta(K)$, то условия $(x_{i}, u_{i}) \geq (x_{j}, u_{i})$ и
$(x_{j}, u_{j}) \geq (x_{i}, u_{j})$ избыточны в системе ограничений
(\ref{equation:all-constraints}).
\end{SmartTheorem}

Рассмотрим задачу согласования опорных чисел в метрике $L_{\infty}$:

\begin{equation}
\label{equation:infinity-problem}
 \varepsilon \to \inf \;\;\;
 s. t. \;\; (x_{i}, u_{i}) \geq (x_{i}, u_{j}), \;\;\;
 |(x_{i}, u_{i}) - h_{i}| \leq \varepsilon
\end{equation}

По сути, данная задача линейного программирования состоит в нахождении такого
минимального $\varepsilon$, при котором система ограничений
(\ref{equation:all-constraints}) является разрешимой.

\begin{SmartTheorem}
 Система ограничений (\ref{equation:all-constraints}) разрешима тогда и только
 тогда, когда ни одна из точек
 $\delta(\{(x, u_{i}) = h_{i} - \varepsilon\})$ не лежит во внутренности
 многогранника $\delta(K)$, где $K$ -- многогранник, определяемый соотношением
 (\ref{equation:upper-bounds-polyhedron}).
\end{SmartTheorem}

\textbf{Доказательство.}

Точка $\delta(\{(x, u_{i}) = h_{i} - \varepsilon\})$ не лежит во внутренности
многогранника $\delta(K)$ тогда и только тогда, когда плоскость
$\{(x, u_{i}) = h_{i} - \varepsilon\}$ пересекает многогранник $K$ (по
одному из свойств преобразования двойственности). В данном случае можно положить
$ x_{i} = h_{K}(u_{i}) $, и тогда 

\begin{align*}
 (x_{i}, u_{i}) & \geq h_{i} - \varepsilon \\
 (x_{i}, u_{j}) & \leq h_{j} + \varepsilon, \; j = 1, \ldots, m.
\end{align*}

Построим таким образом набор точек $(x_{1}, \ldots, x_{m})$. По определению
опорной функции условия $(x_{i}, u_{i}) \geq (x_{i}, u_{j})$ выполняются
автоматически.
$\square$

Полученный результат позволяет организовать процесс нахождения решения задачи
линейного программирования \ref{equation:infinity-problem} с помощью
следующего алгоритма:

\begin{enumerate}
 \item По исходным опорным данным $u_{i}, h_{i}, i = 1, \ldots, m$
 построить тело $K^{0}$ как пересечение полупространств:
 \begin{equation*}
 \label{equation:naive-body}
  K^{0} = \bigcap \limits_{i = 1}^{m} \{(u_{i}, x) \leq h_{i}\}
 \end{equation*}
 \item Пусть $A_{1}, \ldots A_{s}$ --- вершины тела $K^{0}$. Вычислить опорные
 числа тела $K^{0}$ по направлениям $u_{i}, i = 1, \ldots, m$ следующим образом:
 \begin{equation*}
  h^{0}_{i} = \max \limits_{j = 1, \ldots, s} (u_{i}, A_{j})
 \end{equation*}
 \item Вычислить $L_{\infty}$-расстояние от полученных опорных чисел до
 исходных:
 \begin{equation*}
  \varepsilon^{0} = \max \limits_{i = 1, \ldots, m} |h_{i} - h^{0}_{i}|
 \end{equation*}
 Положить $\varepsilon_{-} = 0, \;\; \varepsilon_{+} = \varepsilon_{0}$
 \item Если $|\varepsilon_{+} - \varepsilon_{-}| < \Delta \varepsilon$, то
 остановить алгоритм, в противном случае положить
 $\varepsilon = \frac{\varepsilon_{-} + \varepsilon_{+}}{2}$ и перейти к
 следующему шагу.
 \item Вычислить точки
 $\delta(\{(x, u_{i}) = h_{i} + \varepsilon\}), \; i = 1, \ldots, m$ и построить
 их динамическую выпуклую оболочку $D$.
 \item Вычислить точки
 $\delta(\{(x, u_{i}) = h_{i} - \varepsilon\}), \; i = 1, \ldots, m$ и
 проверить, лежит ли хотя бы одна из них во внутренности $D$. Если хотя бы одна
 лежит, то изменить величину $\varepsilon_{-} = \varepsilon$, иначе изменить
 величину $\varepsilon_{+} = \varepsilon$. Перейти к шагу 4.
\end{enumerate}

В пункте 4 величина $\Delta \varepsilon$ фиксирована, т. е. является
параметром алгоритма, определяющим точность вычисления минимального допустимого
$\varepsilon$. Количество итераций, необходимое для завершения алгоритма,
очевидно, равно $\log_{2} \frac{\varepsilon_{0}}{\Delta \varepsilon}$. На каждом
шаге алгоритма требуется $2m$ раз вычислять двойственные образы плоскостей (за
константное число операций), $1$ раз строить динамическую выпуклую оболочку
$m$ точек (что требует $O(m^2)$ времени при использовании алгоритма
построения трехмерной триангуляции Делоне \cite{Devillers}) и $m$ раз проверять
принадлежность точки построенному многограннику (что требует $O(\log m)$
времени для каждой из $m$ точек по отдельности \cite{Devillers}).
Следовательно, трудоёмкость работы алгоритма составляет

\begin{equation*}
 \log_{2} \frac{\varepsilon_{0}}{\Delta \varepsilon} \cdot O(m^2).
\end{equation*}

Поскольку в реальных задачах величины $\varepsilon_{0}$ и
$\Delta \varepsilon$ различаются не больше чем на несколько порядков, то
можно считать, что представленный алгоритм имеет квадратичную сложность.

Также представляется целесообразным проверить гипотезу, что при соблюдении
разумного предположения о равномерной распределенности опорных направлений
$u_i, i = 1, \ldots, n$ на сфере возможно построение триангуляции Делоне
за линейное время \cite{Attali}, что позволило бы говорить о
линейно-логарифмической сложности алгоритма.

\textbf{4. Реализация и тестирование алгоритма}.
Алгоритм был реализован на основе библиотеки алгоритмов вычислительной
геометрии CGAL \cite{cgal}. Пересечение полупространств в пункте 1 и выпуклая
оболочка в пункте 5 вычислялись на основе алгоритма построения трехмерной
триангуляции Делоне \cite{Devillers}. Выбор в пользу данного алгоритма был
сделан поскольку он позволяет производить быструю многократную проверку
принадлежности точки к выпуклой оболочке \cite{Devillers}.

Тестирование было произведено на опорных числах, полученных эмпирическим путем
на основе измерений реального выпуклого тела (драгоценного камня).
В метрике $L_{\infty}$ алгоритм работает приблизительно в 300
раз быстрее, чем существующий алгоритм решения задачи линейного программирования
на основе метода внутренней точки \cite{Ipopt}. К примеру, решение задачи на
2912 опорных числах было получено за 0,98 секунды, в то время как
предыдущий алгоритм позволял получить решение лишь за 300 секунд \cite{palachev}
(на одних и тех же вычислительных ресурсах).

Безусловно, одно лишь тестирование алгоритма не позволяет судить о превосходстве
или недостатке предлагаемого метода по отношению к предыдущему. Тем не менее,
определенные выводы возможно сделать на основе теоретической оценки скорости
работы предыдущего алгоритма. По теореме 4.7 статьи \cite{WachterBiegler},
фильтрационный метод внутренней точки с линейным поиском, при выполнении ряда
условий, сходится сверхлинейно к минимуму задачи
(\ref{equation:infinity-problem}). Поскольку задача
(\ref{equation:infinity-problem}) содержит квадратичное число ограничений
(см. \cite{GardnerKiderlen,palachev}), на каждом шаге метода выполняются
вычисления общей трудоёмкостью не менее $O(m^2)$ -- т.е. такой же, какую дает
предлагаемый метод. Между тем, на практике оказалось, что по меньшей мере одно
условие теоремы 4.7 из \cite{WachterBiegler} не выполняется в практических
примерах задачи (\ref{equation:infinity-problem}), а именно то,
что алгоритм не должен входить в фазу восстановления (когда производится
минимизация суммарного отклонения ограничений). На примере, рассмотренном в
\cite{palachev}, алгоритм внутренней точки входит в фазу восстановления.
Следовательно, в данном случае мы имеем лишь сходимость, гарантируемую теоремой
2 статьи \cite{WachterBiegler2}, из которой о скорости сходимости ничего не
известно.

Таким образом, предлагающийся метод, позволяет за квадратичное время
гарантированно получить решение задачи (\ref{equation:infinity-problem}),
в отличие от метода внутренней точки, про
скорость сходимости которого применительно к задаче
(\ref{equation:infinity-problem}) содержательных оценок пока не имеется.

\begin{thebibliography}{50}

\bibitem{PrinceWillsky}
\emph{Prince~J.L., Willsky~A.S.}
Reconstructing convex sets from support line measurements //
IEEE Transactions on Pattern Analysis and Machine Intelligence.
1990.
\textbf{12},
N 4.
377--389.

\bibitem{LeleKulkarniWillsky}
\emph{Lele~A.S., Kulkarni~S.R., Willsky~A.S.}
Convex-polygon estimation from support-line measurements and applications to
target reconstruction from laser-radar data //
Journal of the Optical Society of America A.
1992
\textbf{9},
N 10.
1693--1714.

\bibitem{GregorRannou2001}
\emph{Gregor~J., Rannou~F.R.}
Least-squares framework for projection {MRI} reconstruction //
Proceedings of SPIE.
2001.
\textbf{4322}.
888-898.

\bibitem{GregorRannou2002}
\emph{Gregor~J., Rannou~F.R.}
Three-dimensional support function estimation and application for projection
magnetic resonance imaging //
International Journal of Imaging Systems and Technology.
2002.
\textbf{12},
N 1.
43--50.

\bibitem{palachev}
\emph{Палачев~И.А.}
Метод исключения избыточных ограничений в задаче восстановления тела по
измерениям его опорной функции //
Вычислительные методы и программирование.
2015.
\textbf{16}.
348--359.

\bibitem{GardnerKiderlen}
\emph{Gardner~R.J., Kiderlen~M.}
A new algorithm for 3D reconstruction from support functions //
IEEE Transactions on Pattern Analysis and Machine Intelligence.
2009.
\textbf{31},
N 3.
556--562.

\bibitem{Ipopt}
\emph{Wachter~A., Biegler~L.T.}
On the implementation of a primal-dual interior point filter line search
algorithm for large-scale nonlinear programming.
Mathematical Programming.
2006.
\textbf{106}.
N 1.
25--57

\bibitem{WachterBiegler}
\emph{Wachter~A., and Biegler.~L.T.}
Line search filter methods for nonlinear programming: Local convergence.
SIAM Journal on Optimization.
2005.
\textbf{16}.
N 1.
32--48

\bibitem{WachterBiegler2}
\emph{Wachter~A., and Biegler.~L.T.}
Line search filter methods for nonlinear programming: Motivation and global
convergence.
SIAM Journal on Optimization.
2005.
\textbf{16}.
N 1.
1--31

\bibitem{Devillers}
\emph{Devillers~O.}
The Delaunay Hierarchy //
International Journal of Foundations of Computer Science,
World Scientific Publishing.
2002.
\textbf{13}.
163--180.

\bibitem{Attali}
\emph{Attali~D., Boissonnat~J.-D.}
A linear bound on the complexity of the Delaunay triangulation of points on
polyhedral surfaces //
Proceedings of the Seventh ACM Symposium on Solid Modeling and Applications.
2002.
139--146.

\bibitem{cgal}
\textsc{Cgal}, {C}omputational {G}eometry {A}lgorithms {L}ibrary.
\url{http://www.cgal.org}

\end{thebibliography}

\end{document}